(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class A{constructor(){this.master={},this.newData={},this.awaitingAssn={},this.validating={},this.takingAction={},this.awaitingClose={},this.awaitingArchive={}}sortPowerBiDump(e){let t={};for(let n of e){let i=n["Event ID"];t[i]?(i=`${i}-0${Object.keys(t).filter(a=>a.startsWith(n["Event ID"])).length}`,t[i]={outageData:{}}):t[i]={outageData:{}};for(let a in n)t[i].outageData[a]=n[a]}return t}newDataBundler(e){let t={};for(let n in e){let i=e[n].outageData;if(i["PHI Cause"]==="Scheduled")continue;let s=!1;for(let r in t){let o=t[r].outageData;if(n.split("-")[0]===r.split("-")[0]){o.ancillaryEvents.push(i),s=!0;break}if(i.Comments===o.Comments){o.ancillaryEvents.push(i),s=!0;break}if(i.Substation===o.Substation&&i["Start Time"]===o["Start Time"]||i["Start Time"]===o["Start Time"]&&this.areCommentsSimilar(i.Comments,o.Comments)){o.ancillaryEvents.push(i),s=!0;break}if(i["Feeder ID"]===o["Feeder ID"]&&i["Op. Device ID"]===o["Op. Device ID"]){o.ancillaryEvents.push(i),s=!0;break}}s||(t[n]={outageData:{...i,ancillaryEvents:[]}})}return t}areCommentsSimilar(e,t){return e.includes(t)||t.includes(e)}processPowerBiDump(e){let t={major:!1,hybrid:!1,minor:!0,condition:[],assignment:{reported:!1,assigned:!1,assignedActions:{}},completed:!1},n={validated:!1,newData:{},requestedValidations:{}},i={ameSynopsis:{},outageInfo:{},feederInfo:{},ongoingWork:{},patrol:{},nextSteps:{}};for(let a in e)e[a].assignmentStatus=JSON.parse(JSON.stringify(t)),e[a].validationStatus=JSON.parse(JSON.stringify(n)),e[a].catDeliverables=JSON.parse(JSON.stringify(i));return e}findMajorOutages(e){for(let t in e){let n=e[t].outageData,i=n["PHI Cause"],a=n.CI,s=n.Duration,r=n.CMI,o=n["Op. Device ID"];if(a>=500){let l=`CI: ${a}`;e[t].assignmentStatus.condition.push(l),e[t].assignmentStatus.major||(e[t].assignmentStatus.major=!0,e[t].assignmentStatus.minor=!1)}if(o&&o.substring(0,4)==="BRKR"&&(e[t].assignmentStatus.condition.push("Breaker Outage"),e[t].assignmentStatus.major||(e[t].assignmentStatus.major=!0,e[t].assignmentStatus.minor=!1)),r>=6e3&&(e[t].assignmentStatus.condition.push("CMI > 6000"),e[t].assignmentStatus.major||(e[t].assignmentStatus.major=!0,e[t].assignmentStatus.minor=!1)),r>=4500&&(e[t].assignmentStatus.condition.push("CMI > 4500"),e[t].assignmentStatus.major||(e[t].assignmentStatus.hybrid=!0,e[t].assignmentStatus.minor=!1)),s>=500){let l=`Duration ${s}`;e[t].assignmentStatus.condition.push(l),e[t].assignmentStatus.major||(e[t].assignmentStatus.hybrid=!0,e[t].assignmentStatus.minor=!1)}i=="Unknown"&&(e[t].assignmentStatus.condition.push("Unknown"),e[t].assignmentStatus.major||(e[t].assignmentStatus.hybrid=!0,e[t].assignmentStatus.minor=!1))}return e}populateWorkingDirectories(e){for(let t in e){let n=e[t],i=n.assignmentStatus.assignment,a=i.reported,s=i.assigned,r=n.assignmentStatus.completed,o=n.validationStatus.validated;!a&&!s?this.newData[t]||(this.newData[t]=n):s?a&&s&&!r&&(this.takingAction[t]||(this.takingAction[t]={outageData:n.outageData,assignmentStatus:n.assignmentStatus,catDeliverables:n.catDeliverables})):this.awaitingAssn[t]||(this.awaitingAssn[t]=n),o||this.validating[t]||(this.validating[t]={outageData:n.outageData,validationStatus:n.validationStatus,newData:{}}),!o&&r||o&&!r?this.awaitingClose[t]||(this.awaitingClose[t]=n):o&&r&&(this.awaitingArchive[t]||(this.awaitingArchive[t]=n))}console.log(this)}moverFunction(e,t,n){this[t][e]&&(this[n][e]=this[t][e],delete this[t][e])}async writeChangesToAzure(e,t){let n=await e.writeData(t);console.log(n?"Data successfully written to Azure Cosmos DB.":"Failed to write data to Azure Cosmos DB.")}mergeData(e,t){for(let n in e)t[n]?console.log(`Duplicate event found: ${n}`):this.master[n]=e[n];console.log("Merged data:",this.master)}}class W{constructor(e){this.display=document.getElementById(e)}clearVisualizer(){this.display.innerHTML=""}displayByView(e,t){const n=`${e}-view`;switch(this.display.className="",this.display.classList.add("visualizer"),this.display.classList.add(n),e){case"home":this.populateHomeView(t);break;case"ame":this.populateAMEView(t);break;case"ima":this.populateIMAView();break;case"help":this.populateHelpView();break;default:console.error(`Unknown view: ${n}`)}}populateHomeView(e){const t=this.createGridObject(6);let i=this.mainTitle("The Home of Pepco Reliability"),a="Welcome to the AME and IMA Home of Pepco Reliability.",s="We are the inquisitive eye that sees beyond the outage. Our mission is to preserve and correct data, ensuring accuracy and reliability.",r="Following through with outage investigations, corrective actions, and stakeholder engagement.",o=this.createParagraph(a),l=this.createParagraph(s),v=this.createParagraph(r);t.appendChild(i),t.appendChild(o),t.appendChild(l),t.appendChild(v)}populateAMEView(e){let t=new D(e);const n=this.createGridObject(4);let a=this.mainTitle("AME Home"),r=this.createParagraph("Welcome! Use the filters below to review outage data.");n.appendChild(a),n.appendChild(r);const o=this.createGridObject(6,1,5);let l=this.createSecTitle("Corrective Action Resources");o.appendChild(l);let v=this.hztCont(100);o.appendChild(v);let m=this.hztCont(100,"useful-links");v.appendChild(m);let O=t.iconWithText("a","./public/power-bi-icon.png","Feeder Dashboard"),M=t.iconWithText("a","./public/power-bi-icon.png","Project List"),b=t.iconWithText("a","./public/power-bi-icon.png","MDO View"),P=t.iconWithText("a","./public/power-bi-icon.png","GIS");m.appendChild(O),m.appendChild(M),m.appendChild(b),m.appendChild(P);let w=this.createGridObject(10,9,0,2),E=this.hztCont(100,"top-row"),h=this.hztCont(34,"outlined"),x=this.createSecTitle("Filters:");x.style.width="100%",h.style.height="100%",h.appendChild(x);let T=document.createElement("select");T.classList.add("filter-dropdown"),["Option 1","Option 2","Option 3"].forEach(c=>{let S=document.createElement("option");S.value=c,S.textContent=c,T.appendChild(S)}),h.appendChild(T);let L=this.vertCont(100,"search-container"),u=document.createElement("input");u.type="text",u.placeholder="Search...",u.classList.add("search-input");let g=document.createElement("div");g.classList.add("suggestions-box"),u.addEventListener("input",c=>{g.innerHTML="",["Suggestion 1","Suggestion 2","Suggestion 3"].forEach(k=>{let y=document.createElement("div");y.textContent=k,y.classList.add("suggestion-item"),y.addEventListener("click",()=>{u.value=k,g.innerHTML=""}),g.appendChild(y)})}),L.appendChild(u),L.appendChild(g),h.appendChild(L),E.appendChild(h);let f=this.hztCont(65,"outlined","viewer");f.style.height="100%",f.style.overflowX="scroll",f.style.overflowY="hidden",new D(e).nanoCard(e).forEach(c=>{f.appendChild(c)}),E.appendChild(f);let I=this.vertList("viewer","ame-viewer");t.eventCard(e).forEach(c=>{I.appendChild(c)}),w.appendChild(E),w.appendChild(I),this.display.appendChild(w)}createGridObject(e,t,n=null,i=null){const a=document.createElement("div");return a.classList.add("grid-object"),a.style.gridColumnEnd=`span ${e}`,a.style.gridRowEnd=`span ${t}`,n!==null&&(a.style.gridColumnStart=n),i!==null&&(a.style.gridRowStart=i),this.display.appendChild(a),a}vertCont(e,...t){let n=document.createElement("div");return n.classList.add("vert-container"),e&&(n.style.maxWidth=`${e}%`),t.length>0&&n.classList.add(...t),n}hztCont(e,...t){let n=document.createElement("div");return n.classList.add("hzt-container"),e&&(n.style.width=`${e}%`),t.length>0&&n.classList.add(...t),n}vertList(...e){const t=document.createElement("div");return t.classList.add("vertical-list"),e.length>0&&t.classList.add(...e),t}mainTitle(e,...t){return this.createElementWithText("h1",e,"main-title",...t)}createSecTitle(e,...t){return this.createElementWithText("h2",e,"secondary-title",...t)}createParagraph(e,...t){return this.createElementWithText("p",e,"paragraph",...t)}createLink(e,t,...n){let i=this.createElementWithText("a",e,"link",...n);return i.href=`${t}`,i.target="_blank",i}createElementWithText(e,t,...n){const i=document.createElement(e);return i.textContent=t,i.classList.add(...n),i}actionButton(e,t){const n=document.createElement("button");return n.classList.add("action-button",`${e}-button`),n.innerHTML=`${e}`,n.addEventListener("click",t),n}eventCard(e){return this.hztCont(100,"event-card")}fileUploadButton(e,t){const n=document.createElement("div");n.classList.add("file-upload-container");const i=document.createElement("input");i.type="file",i.id=e,i.style.display="none";const a=document.createElement("button");return a.classList.add("file-upload-button"),a.innerHTML="Upload File",a.addEventListener("click",()=>{i.click()}),i.addEventListener("change",t),n.appendChild(i),n.appendChild(a),n}}class D{constructor(e){this.master=e}eventCard(e){let t=[];console.log(e);for(let n in e){let i=e[n].outageData,a=document.createElement("div");a.classList.add("event-card"),console.log(a),this.eventCardTitle(i,a);let s=this.addTags(e,n);a.appendChild(s),this.dataMap=this.createDataMap(i),t.push(a)}return t}createDataMap(e){return{eventId:e["Event ID"],region:e.Region,state:e.State,district:e.District,substation:e.Substation,feederId:e["Feeder ID"],startTime:e["Start Time"],stopTime:e["Stop Time"],ci:e.CI,cmi:e.CMI,eventCaidi:e["Event CAIDI"],eventCaidiEffect:e["Event CAIDI Effect"],duration:e.Duration,ni:e.NI,euCause:e["EU Cause"],phiCause:e["PHI Cause"],subcause:e.Subcause,equipmentType:e["Equipment Type"],operatingDevice:e["Operating Device"],opDeviceId:e["Op. Device ID"],comments:e.Comments,troublemanComments:e["Troubleman Comments"],faultLocation1:e["Fault Location 1"],faultLocation2:e["Fault Location 2"],firstCall:e["First Call"],dispatchTime:e["Dispatch Time"],enRouteTime:e["En Route Time"],onSiteTime:e["On Site Time"],completionTime:e["Completion Time"],minorStorm:e["Minor Storm"],companyStorm:e["Company Storm (MED)"],partsServedFlag:e["Parts Served Flag"]}}eventCardTitle(e,t){const n=this.createElementWithText("div",`${e["Event ID"]}`,"event-id","sec-title"),i=this.createElementWithText("div",`${e.Substation.split(/(?=\d)/)[0].trim()}`,"substation"),a=this.createElementWithText("div",`${e["Feeder ID"]}`,"circuit");let s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",t.appendChild(n),t.appendChild(s),s.appendChild(i),s.appendChild(a)}nanoCard(e){let t=[];for(let n in e){let i=e[n].outageData,a=document.createElement("div");a.classList.add("nano-card"),this.eventCardTitle(i,a);let s=this.addTags(e,n);a.appendChild(s),this.dataMap=this.createDataMap(i),t.push(a),console.log(a)}return t}createElementWithText(e,t,...n){const i=document.createElement(e);return i.textContent=t,i.classList.add(...n),i}iconWithText(e,t,n){let i=document.createElement("div"),a=document.createElement("img");a.classList.add("icon"),a.src=`${t}`;let s=document.createElement(`${e}`);return s.textContent=n,i.appendChild(a),i.appendChild(s),i}addTags(e,t){let n=e[t].assignmentStatus.condition,i=document.createElement("div");if(i.classList.add("tags-container"),n.length>0){let a=this.createElementWithText("div","MAJOR");a.classList.add("major","tag"),i.appendChild(a)}else{let a=this.createElementWithText("div","Minor");a.classList.add("minor","tag"),i.appendChild(a)}return i}addCause(e,t){const n=this.createElementWithText("p",`Cause: ${t}`,"cause");e.appendChild(n)}}let p,C={};document.addEventListener("DOMContentLoaded",()=>{fetch("./sample.json").then(i=>{if(!i.ok)throw new Error("Network response was not ok");return console.log(i.json),i.json()}).then(i=>{C=i,console.log("Sample data loaded:",C),p=new A,p.master=C,p.populateWorkingDirectories(p.master),p.findMajorOutages(p.master)}).catch(i=>console.error("Error loading sample.json:",i));const d=document.querySelector(".main-nav-container"),e=new W("visualizer"),t=document.querySelector(".expander-row");e.displayByView("home"),d.addEventListener("click",i=>{const a=i.target,s=a.closest(".nav-section-row");if(s&&!a.classList.contains("expander")){console.log("what did i click?",a.classList),document.querySelectorAll(".nav-section-row").forEach(o=>{o.classList.remove("active")}),s.classList.add("active");let r="";s.querySelector(".home-icon")?(r="home",e.clearVisualizer(),e.displayByView(r,C)):s.querySelector(".ame-icon")?(r="ame",e.clearVisualizer(),e.displayByView(r,C)):s.querySelector(".ima-icon")?(r="ima",console.log(r)):s.querySelector(".help-icon")&&(r="help",console.log(r))}}),document.querySelectorAll(".nav-section-row").forEach(i=>{i.addEventListener("click",a=>{a.target.classList.contains("nav-row-expand")&&i.closest(".nav-section-container").querySelectorAll(".nav-section-row").forEach(o=>{o.classList.toggle("expanded")})})}),t.addEventListener("mouseenter",()=>{d.classList.add("expanded")}),d.addEventListener("mouseleave",()=>{d.classList.remove("expanded")})});
