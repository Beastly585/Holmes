(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class A{constructor(){this.master={},this.newData={},this.awaitingAssn={},this.validating={},this.takingAction={},this.awaitingClose={},this.awaitingArchive={}}sortPowerBiDump(e){let t={};for(let a of e){let i=a["Event ID"];t[i]?(i=`${i}-0${Object.keys(t).filter(n=>n.startsWith(a["Event ID"])).length}`,t[i]={outageData:{}}):t[i]={outageData:{}};for(let n in a)t[i].outageData[n]=a[n]}return t}newDataBundler(e){let t={};for(let a in e){let i=e[a].outageData;if(i["PHI Cause"]==="Scheduled")continue;let s=!1;for(let r in t){let o=t[r].outageData;if(a.split("-")[0]===r.split("-")[0]){o.ancillaryEvents.push(i),s=!0;break}if(i.Comments===o.Comments){o.ancillaryEvents.push(i),s=!0;break}if(i.Substation===o.Substation&&i["Start Time"]===o["Start Time"]||i["Start Time"]===o["Start Time"]&&this.areCommentsSimilar(i.Comments,o.Comments)){o.ancillaryEvents.push(i),s=!0;break}if(i["Feeder ID"]===o["Feeder ID"]&&i["Op. Device ID"]===o["Op. Device ID"]){o.ancillaryEvents.push(i),s=!0;break}}s||(t[a]={outageData:{...i,ancillaryEvents:[]}})}return t}areCommentsSimilar(e,t){return e.includes(t)||t.includes(e)}processPowerBiDump(e){let t={major:!1,hybrid:!1,minor:!0,condition:[],assignment:{reported:!1,assigned:!1,assignedActions:{}},completed:!1},a={validated:!1,newData:{},requestedValidations:{}},i={ameSynopsis:{},outageInfo:{},feederInfo:{},ongoingWork:{},patrol:{},nextSteps:{}};for(let n in e)e[n].assignmentStatus=JSON.parse(JSON.stringify(t)),e[n].validationStatus=JSON.parse(JSON.stringify(a)),e[n].catDeliverables=JSON.parse(JSON.stringify(i));return e}findMajorOutages(e){for(let t in e){let a=e[t].outageData,i=a["PHI Cause"],n=a.CI,s=a.Duration,r=a.CMI,o=a["Op. Device ID"];if(n>=500){let l=`CI: ${n}`;e[t].assignmentStatus.condition.push(l),e[t].assignmentStatus.major||(e[t].assignmentStatus.major=!0,e[t].assignmentStatus.minor=!1)}if(o&&o.substring(0,4)==="BRKR"&&(e[t].assignmentStatus.condition.push("Breaker Outage"),e[t].assignmentStatus.major||(e[t].assignmentStatus.major=!0,e[t].assignmentStatus.minor=!1)),r>=6e3&&(e[t].assignmentStatus.condition.push("CMI > 6000"),e[t].assignmentStatus.major||(e[t].assignmentStatus.major=!0,e[t].assignmentStatus.minor=!1)),r>=4500&&(e[t].assignmentStatus.condition.push("CMI > 4500"),e[t].assignmentStatus.major||(e[t].assignmentStatus.hybrid=!0,e[t].assignmentStatus.minor=!1)),s>=500){let l=`Duration ${s}`;e[t].assignmentStatus.condition.push(l),e[t].assignmentStatus.major||(e[t].assignmentStatus.hybrid=!0,e[t].assignmentStatus.minor=!1)}i=="Unknown"&&(e[t].assignmentStatus.condition.push("Unknown"),e[t].assignmentStatus.major||(e[t].assignmentStatus.hybrid=!0,e[t].assignmentStatus.minor=!1))}return e}populateWorkingDirectories(e){for(let t in e){let a=e[t],i=a.assignmentStatus.assignment,n=i.reported,s=i.assigned,r=a.assignmentStatus.completed,o=a.validationStatus.validated;!n&&!s?this.newData[t]||(this.newData[t]=a):s?n&&s&&!r&&(this.takingAction[t]||(this.takingAction[t]={outageData:a.outageData,assignmentStatus:a.assignmentStatus,catDeliverables:a.catDeliverables})):this.awaitingAssn[t]||(this.awaitingAssn[t]=a),o||this.validating[t]||(this.validating[t]={outageData:a.outageData,validationStatus:a.validationStatus,newData:{}}),!o&&r||o&&!r?this.awaitingClose[t]||(this.awaitingClose[t]=a):o&&r&&(this.awaitingArchive[t]||(this.awaitingArchive[t]=a))}console.log(this)}moverFunction(e,t,a){this[t][e]&&(this[a][e]=this[t][e],delete this[t][e])}async writeChangesToAzure(e,t){let a=await e.writeData(t);console.log(a?"Data successfully written to Azure Cosmos DB.":"Failed to write data to Azure Cosmos DB.")}mergeData(e,t){for(let a in e)t[a]?console.log(`Duplicate event found: ${a}`):this.master[a]=e[a];console.log("Merged data:",this.master)}}class W{constructor(e){this.display=document.getElementById(e)}clearVisualizer(){this.display.innerHTML=""}displayByView(e,t){const a=`${e}-view`;switch(this.display.className="",this.display.classList.add("visualizer"),this.display.classList.add(a),e){case"home":this.populateHomeView(t);break;case"ame":this.populateAMEView(t);break;case"ima":this.populateIMAView();break;case"help":this.populateHelpView();break;default:console.error(`Unknown view: ${a}`)}}populateHomeView(e){const t=this.createGridObject(6);let i=this.mainTitle("The Home of Pepco Reliability"),n="Welcome to the AME and IMA Home of Pepco Reliability.",s="We are the inquisitive eye that sees beyond the outage. Our mission is to preserve and correct data, ensuring accuracy and reliability.",r="Following through with outage investigations, corrective actions, and stakeholder engagement.",o=this.createParagraph(n),l=this.createParagraph(s),v=this.createParagraph(r);t.appendChild(i),t.appendChild(o),t.appendChild(l),t.appendChild(v)}populateAMEView(e){let t=new D(e);const a=this.createGridObject(4);let n=this.mainTitle("AME Home"),r=this.createParagraph("Welcome! Use the filters below to review outage data.");a.appendChild(n),a.appendChild(r);const o=this.createGridObject(6,1,5);let l=this.createSecTitle("Corrective Action Resources");o.appendChild(l);let v=this.hztCont(100);o.appendChild(v);let m=this.hztCont(100,"useful-links");v.appendChild(m);let O=t.iconWithText("a","./public/power-bi-icon.png","Feeder Dashboard"),M=t.iconWithText("a","./public/power-bi-icon.png","Project List"),b=t.iconWithText("a","./public/power-bi-icon.png","MDO View"),P=t.iconWithText("a","./public/power-bi-icon.png","GIS");m.appendChild(O),m.appendChild(M),m.appendChild(b),m.appendChild(P);let w=this.createGridObject(10,9,0,2),E=this.hztCont(100,"top-row"),h=this.hztCont(34,"outlined"),x=this.createSecTitle("Filters:");x.style.width="100%",h.style.height="100%",h.appendChild(x);let T=document.createElement("select");T.classList.add("filter-dropdown"),["Option 1","Option 2","Option 3"].forEach(c=>{let S=document.createElement("option");S.value=c,S.textContent=c,T.appendChild(S)}),h.appendChild(T);let L=this.vertCont(100,"search-container"),u=document.createElement("input");u.type="text",u.placeholder="Search...",u.classList.add("search-input");let g=document.createElement("div");g.classList.add("suggestions-box"),u.addEventListener("input",c=>{g.innerHTML="",["Suggestion 1","Suggestion 2","Suggestion 3"].forEach(k=>{let y=document.createElement("div");y.textContent=k,y.classList.add("suggestion-item"),y.addEventListener("click",()=>{u.value=k,g.innerHTML=""}),g.appendChild(y)})}),L.appendChild(u),L.appendChild(g),h.appendChild(L),E.appendChild(h);let f=this.hztCont(65,"outlined","viewer");f.style.height="100%",f.style.overflowX="scroll",f.style.overflowY="hidden",new D(e).nanoCard(e).forEach(c=>{f.appendChild(c)}),E.appendChild(f);let I=this.vertList("viewer","ame-viewer");t.eventCard(e).forEach(c=>{I.appendChild(c)}),w.appendChild(E),w.appendChild(I),this.display.appendChild(w)}createGridObject(e,t,a=null,i=null){const n=document.createElement("div");return n.classList.add("grid-object"),n.style.gridColumnEnd=`span ${e}`,n.style.gridRowEnd=`span ${t}`,a!==null&&(n.style.gridColumnStart=a),i!==null&&(n.style.gridRowStart=i),this.display.appendChild(n),n}vertCont(e,...t){let a=document.createElement("div");return a.classList.add("vert-container"),e&&(a.style.maxWidth=`${e}%`),t.length>0&&a.classList.add(...t),a}hztCont(e,...t){let a=document.createElement("div");return a.classList.add("hzt-container"),e&&(a.style.width=`${e}%`),t.length>0&&a.classList.add(...t),a}vertList(...e){const t=document.createElement("div");return t.classList.add("vertical-list"),e.length>0&&t.classList.add(...e),t}mainTitle(e,...t){return this.createElementWithText("h1",e,"main-title",...t)}createSecTitle(e,...t){return this.createElementWithText("h2",e,"secondary-title",...t)}createParagraph(e,...t){return this.createElementWithText("p",e,"paragraph",...t)}createLink(e,t,...a){let i=this.createElementWithText("a",e,"link",...a);return i.href=`${t}`,i.target="_blank",i}createElementWithText(e,t,...a){const i=document.createElement(e);return i.textContent=t,i.classList.add(...a),i}actionButton(e,t){const a=document.createElement("button");return a.classList.add("action-button",`${e}-button`),a.innerHTML=`${e}`,a.addEventListener("click",t),a}eventCard(e){return this.hztCont(100,"event-card")}fileUploadButton(e,t){const a=document.createElement("div");a.classList.add("file-upload-container");const i=document.createElement("input");i.type="file",i.id=e,i.style.display="none";const n=document.createElement("button");return n.classList.add("file-upload-button"),n.innerHTML="Upload File",n.addEventListener("click",()=>{i.click()}),i.addEventListener("change",t),a.appendChild(i),a.appendChild(n),a}}class D{constructor(e){this.master=e}eventCard(e){let t=[];console.log(e);for(let a in e){let i=e[a].outageData,n=document.createElement("div");n.classList.add("event-card"),console.log(n),this.eventCardTitle(i,n);let s=this.addTags(e,a);n.appendChild(s),this.dataMap=this.createDataMap(i),t.push(n)}return t}createDataMap(e){return{eventId:e["Event ID"],region:e.Region,state:e.State,district:e.District,substation:e.Substation,feederId:e["Feeder ID"],startTime:e["Start Time"],stopTime:e["Stop Time"],ci:e.CI,cmi:e.CMI,eventCaidi:e["Event CAIDI"],eventCaidiEffect:e["Event CAIDI Effect"],duration:e.Duration,ni:e.NI,euCause:e["EU Cause"],phiCause:e["PHI Cause"],subcause:e.Subcause,equipmentType:e["Equipment Type"],operatingDevice:e["Operating Device"],opDeviceId:e["Op. Device ID"],comments:e.Comments,troublemanComments:e["Troubleman Comments"],faultLocation1:e["Fault Location 1"],faultLocation2:e["Fault Location 2"],firstCall:e["First Call"],dispatchTime:e["Dispatch Time"],enRouteTime:e["En Route Time"],onSiteTime:e["On Site Time"],completionTime:e["Completion Time"],minorStorm:e["Minor Storm"],companyStorm:e["Company Storm (MED)"],partsServedFlag:e["Parts Served Flag"]}}eventCardTitle(e,t){const a=this.createElementWithText("div",`${e["Event ID"]}`,"event-id","sec-title"),i=this.createElementWithText("div",`${e.Substation.split(/(?=\d)/)[0].trim()}`,"substation"),n=this.createElementWithText("div",`${e["Feeder ID"]}`,"circuit");let s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",t.appendChild(a),t.appendChild(s),s.appendChild(i),s.appendChild(n)}nanoCard(e){let t=[];for(let a in e){let i=e[a].outageData,n=document.createElement("div");n.classList.add("nano-card"),this.eventCardTitle(i,n);let s=this.addTags(e,a);n.appendChild(s),this.dataMap=this.createDataMap(i),t.push(n),console.log(n)}return t}createElementWithText(e,t,...a){const i=document.createElement(e);return i.textContent=t,i.classList.add(...a),i}iconWithText(e,t,a){let i=document.createElement("div"),n=document.createElement("img");n.classList.add("icon"),n.src=`${t}`;let s=document.createElement(`${e}`);return s.textContent=a,i.appendChild(n),i.appendChild(s),i}addTags(e,t){let a=e[t].assignmentStatus.condition,i=document.createElement("div");if(i.classList.add("tags-container"),a.length>0){let n=this.createElementWithText("div","MAJOR");n.classList.add("major","tag"),i.appendChild(n)}else{let n=this.createElementWithText("div","Minor");n.classList.add("minor","tag"),i.appendChild(n)}return i}addCause(e,t){const a=this.createElementWithText("p",`Cause: ${t}`,"cause");e.appendChild(a)}}let p,C={};document.addEventListener("DOMContentLoaded",()=>{fetch("./sample.json").then(i=>{if(!i.ok)throw new Error("Network response was not ok");return i.json()}).then(i=>{C=i,console.log("Sample data loaded:",C),p=new A,p.master=C,p.populateWorkingDirectories(p.master),p.findMajorOutages(p.master)}).catch(i=>console.error("Error loading sample.json:",i));const d=document.querySelector(".main-nav-container"),e=new W("visualizer"),t=document.querySelector(".expander-row");e.displayByView("home"),d.addEventListener("click",i=>{const n=i.target,s=n.closest(".nav-section-row");if(s&&!n.classList.contains("expander")){console.log("what did i click?",n.classList),document.querySelectorAll(".nav-section-row").forEach(o=>{o.classList.remove("active")}),s.classList.add("active");let r="";s.querySelector(".home-icon")?(r="home",e.clearVisualizer(),e.displayByView(r,C)):s.querySelector(".ame-icon")?(r="ame",e.clearVisualizer(),e.displayByView(r,C)):s.querySelector(".ima-icon")?(r="ima",console.log(r)):s.querySelector(".help-icon")&&(r="help",console.log(r))}}),document.querySelectorAll(".nav-section-row").forEach(i=>{i.addEventListener("click",n=>{n.target.classList.contains("nav-row-expand")&&i.closest(".nav-section-container").querySelectorAll(".nav-section-row").forEach(o=>{o.classList.toggle("expanded")})})}),t.addEventListener("mouseenter",()=>{d.classList.add("expanded")}),d.addEventListener("mouseleave",()=>{d.classList.remove("expanded")})});
