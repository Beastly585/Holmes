
let powerBiDataDump = [
    {
        'Event ID': '3275785',
        'Region': 'PEPCO',
        'State': 'MDPEPCO',
        'District': 'PRINCE GEORGES CO',
        'Substation': 'Kingswood 85',
        'Feeder ID': '14794',
        'Start Time': '1/1/2025 10:45:30 AM',
        'Stop Time': '1/1/2025 11:50:00 AM',
        'CI': 167,
        'CMI': 10771.5,
        'Event CAIDI': 64.5,
        'Event CAIDI Effect': 0.136868285,
        'Duration': 64.5,
        'NI': 1,
        'EU Cause': 'Weather (Other than Lightning)',
        'PHI Cause': 'Weather / Wind',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'Fuse',
        'Op. Device ID': 'FS829362-780810_14794',
        'Comments': 'FD B & CPH 100 AMP FUSES BLOWN @FUSE POLE #829362-7881 DUE TO HEAVY WINDS, REPLACED BOTH W/ NEW, MULTI CUST CHECK GOOD, ALL LOAD RESTORED',
        'Troubleman Comments': '',
        'Fault Location 1': '829362-780810',
        'Fault Location 2': '',
        'First Call': '1/1/2025 10:45:30 AM',
        'Dispatch Time': '',
        'En Route Time': '',
        'On Site Time': '',
        'Completion Time': '1/1/2025 12:51:51 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275819',
        'Region': 'PEPCO',
        'State': 'MDPEPCO',
        'District': 'MONTGOMERY COUNTY',
        'Substation': 'Whiteoak 153',
        'Feeder ID': '14208',
        'Start Time': '1/1/2025 12:35:00 PM',
        'Stop Time': '1/1/2025 2:31:00 PM',
        'CI': 81,
        'CMI': 9396,
        'Event CAIDI': 116,
        'Event CAIDI Effect': 0.004797171,
        'Duration': 116,
        'NI': 1,
        'EU Cause': 'Vegetation',
        'PHI Cause': 'Tree Outside ROW - Down',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'Fuse',
        'Op. Device ID': 'FS803434-490230_14208',
        'Comments': 'fd b and c ph fuse blowen @p4923 due to large tree that hit wires @p 5513 replaced fuses restoring all load',
        'Troubleman Comments': '[E913387] PragmaFIELD E035:482 AutoDispose\n08:07 01/08/25 e983891: Issued OC 12733 on event 3275819 to correct customer count.',
        'Fault Location 1': '803434-490230',
        'Fault Location 2': '',
        'First Call': '1/1/2025 12:35:24 PM',
        'Dispatch Time': '1/1/2025 1:19:05 PM',
        'En Route Time': '1/1/2025 1:19:05 PM',
        'On Site Time': '1/1/2025 2:14:45 PM',
        'Completion Time': '1/1/2025 4:19:09 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275830',
        'Region': 'PEPCO',
        'State': 'DC',
        'District': 'DISTRICT OF COLUMBIA',
        'Substation': 'Alabama Ave 136',
        'Feeder ID': '15166',
        'Start Time': '1/1/2025 12:39:41 PM',
        'Stop Time': '1/1/2025 2:10:00 PM',
        'CI': 1,
        'CMI': 90.31666667,
        'Event CAIDI': 90.31666667,
        'Event CAIDI Effect': 0.000437379,
        'Duration': 90.31666667,
        'NI': 1,
        'EU Cause': 'Equipment Overhead',
        'PHI Cause': 'Equipment Failure',
        'Subcause': 'Dist Secondary - OH',
        'Equipment Type': 'Service',
        'Operating Device': 'Service',
        'Op. Device ID': 'XFM800367-140230_15166',
        'Comments': 'Found Old cu triplex service burnt in half replaced w/ new AL Triplex from P#800367-330110 Perm Repairs',
        'Troubleman Comments': '[E913247] PragmaFIELD E034:484 AutoDispose',
        'Fault Location 1': '',
        'Fault Location 2': '',
        'First Call': '1/1/2025 12:39:41 PM',
        'Dispatch Time': '1/1/2025 12:49:34 PM',
        'En Route Time': '1/1/2025 12:49:34 PM',
        'On Site Time': '1/1/2025 1:27:10 PM',
        'Completion Time': '1/1/2025 3:32:16 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275854',
        'Region': 'PEPCO',
        'State': 'MDPEPCO',
        'District': 'PRINCE GEORGES CO',
        'Substation': 'Suitland 134',
        'Feeder ID': '14033',
        'Start Time': '1/1/2025 1:11:00 PM',
        'Stop Time': '1/1/2025 3:28:00 PM',
        'CI': 77,
        'CMI': 10549,
        'Event CAIDI': 137,
        'Event CAIDI Effect': -0.019279356,
        'Duration': 137,
        'NI': 1,
        'EU Cause': 'Vegetation',
        'PHI Cause': 'Tree Outside ROW - Down',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'Wire - Bare',
        'Op. Device ID': 'TSRCLR817376-230670_14033',
        'Comments': 'Circuit 14033 fnd a phs down between poles 816375-8164 and 816375-8450 due to large tree. rplcd 150 ft of #4 bare cu primary and closed trip saver at pole 817316-2367 restoring all load. also rplcd triplex svcs at 1807 and 1809 arcadia ave due to same tree.',
        'Troubleman Comments': '[E989087] PHIDO-20250101-00150 HAS BEEN DISPOSED',
        'Fault Location 1': '816375-810640',
        'Fault Location 2': '816375-840500',
        'First Call': '1/1/2025 1:11:22 PM',
        'Dispatch Time': '1/1/2025 1:30:01 PM',
        'En Route Time': '1/1/2025 2:36:00 PM',
        'On Site Time': '1/1/2025 1:52:06 PM',
        'Completion Time': '1/1/2025 4:43:27 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275867',
        'Region': 'PEPCO',
        'State': 'DC',
        'District': 'DISTRICT OF COLUMBIA',
        'Substation': 'Van ness 129',
        'Feeder ID': '14135',
        'Start Time': '1/1/2025 1:36:00 PM',
        'Stop Time': '1/1/2025 4:12:00 PM',
        'CI': 443,
        'CMI': 69108,
        'Event CAIDI': 156,
        'Event CAIDI Effect': -0.236285333,
        'Duration': 156,
        'NI': 1,
        'EU Cause': 'Vegetation',
        'PHI Cause': 'Tree Outside ROW - Down',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'ACR',
        'Op. Device ID': 'RCLR782407-260710_14135',
        'Comments': 'CRKT 14135 FOUND LRG TREE LEANING ON ALL 3PH AT POLE #780408-810290 WHICH DAMAGED THE TOP OF POLE. CREW REMOVED LIMB AND REPAIRED.',
        'Troubleman Comments': '13:47 01/01/25 e093904: XFMR PINGS OFF',
        'Fault Location 1': '780408-810290',
        'Fault Location 2': '',
        'First Call': '1/1/2025 1:36:07 PM',
        'Dispatch Time': '1/1/2025 1:55:36 PM',
        'En Route Time': '1/1/2025 1:55:36 PM',
        'On Site Time': '1/1/2025 2:18:17 PM',
        'Completion Time': '1/1/2025 6:29:54 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275945',
        'Region': 'PEPCO',
        'State': 'MDPEPCO',
        'District': 'PRINCE GEORGES CO',
        'Substation': 'Beech Road 159',
        'Feeder ID': '14251',
        'Start Time': '1/1/2025 3:16:04 PM',
        'Stop Time': '1/1/2025 5:20:07 PM',
        'CI': 11,
        'CMI': 1364.55,
        'Event CAIDI': 124.05,
        'Event CAIDI Effect': -0.000653424,
        'Duration': 124.05,
        'NI': 1,
        'EU Cause': 'Unknown',
        'PHI Cause': 'Unknown',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'Fuse',
        'Op. Device ID': 'XFM814364-590650_14251',
        'Comments': 'fnd b phs cutout fuse blwn. no apparent cause. replaced w new and closed restoring all load.',
        'Troubleman Comments': '[E989087] PragmaFIELD E031:480 AutoDispose',
        'Fault Location 1': '814364-590650',
        'Fault Location 2': '',
        'First Call': '1/1/2025 3:16:04 PM',
        'Dispatch Time': '1/1/2025 4:31:50 PM',
        'En Route Time': '1/1/2025 4:31:50 PM',
        'On Site Time': '1/1/2025 4:46:35 PM',
        'Completion Time': '1/1/2025 5:45:24 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275966',
        'Region': 'PEPCO',
        'State': 'MDPEPCO',
        'District': 'MONTGOMERY COUNTY',
        'Substation': 'Wheaton 75',
        'Feeder ID': '14838',
        'Start Time': '1/1/2025 4:23:00 PM',
        'Stop Time': '1/1/2025 5:55:00 PM',
        'CI': 40,
        'CMI': 3680,
        'Event CAIDI': 92,
        'Event CAIDI Effect': 0.016513064,
        'Duration': 92,
        'NI': 1,
        'EU Cause': 'Vegetation',
        'PHI Cause': 'Tree Outside ROW - Down',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'Pole',
        'Op. Device ID': '<1PhPrimaryOh.50069431>',
        'Comments': 'Replaced broken pole 794444-940700 wit a 45ft class 2 all load restored',
        'Troubleman Comments': '[E418564] PHIDO-20250101-00267 HAS BEEN DISPOSED\n09:59 01/08/25 e983891: Issued OC 12734 on event 3275966 to remodel for consolidation. Excluded events 3276000, 3275999.',
        'Fault Location 1': '794444-9470',
        'Fault Location 2': '',
        'First Call': '1/1/2025 4:23:21 PM',
        'Dispatch Time': '1/1/2025 8:16:38 PM',
        'En Route Time': '1/1/2025 8:16:38 PM',
        'On Site Time': '1/1/2025 8:16:46 PM',
        'Completion Time': '1/1/2025 10:55:10 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    },
    {
        'Event ID': '3275966',
        'Region': 'PEPCO',
        'State': 'MDPEPCO',
        'District': 'MONTGOMERY COUNTY',
        'Substation': 'Wheaton 75',
        'Feeder ID': '14838',
        'Start Time': '1/1/2025 4:23:00 PM',
        'Stop Time': '1/1/2025 7:31:00 PM',
        'CI': 5,
        'CMI': 940,
        'Event CAIDI': 188,
        'Event CAIDI Effect': -0.005006046,
        'Duration': 188,
        'NI': 1,
        'EU Cause': 'Vegetation',
        'PHI Cause': 'Tree Outside ROW - Down',
        'Subcause': 'Dist Primary - OH',
        'Equipment Type': 'Unselected',
        'Operating Device': 'Pole',
        'Op. Device ID': '<1PhPrimaryOh.50069431>',
        'Comments': 'Replaced broken pole 794444-940700 wit a 45ft class 2 all load restored',
        'Troubleman Comments': '[E418564] PHIDO-20250101-00267 HAS BEEN DISPOSED\n09:59 01/08/25 e983891: Issued OC 12734 on event 3275966 to remodel for consolidation. Excluded events 3276000, 3275999.',
        'Fault Location 1': '794444-9470',
        'Fault Location 2': '',
        'First Call': '1/1/2025 4:23:21 PM',
        'Dispatch Time': '1/1/2025 8:16:38 PM',
        'En Route Time': '1/1/2025 8:16:38 PM',
        'On Site Time': '1/1/2025 8:16:46 PM',
        'Completion Time': '1/1/2025 10:55:10 PM',
        'Minor Storm': 'N',
        'Company Storm (MED)': 'N',
        'Parts Served Flag': 0
    }
];



// Create important repos early - likely to change
    // Each of the repos below is to be structured repo[day][events][subKeys]


import { DataProcessor } from './dataManager.js';  // Import the DataProcessor class
// import {handleFile, rawTicket, sortedTicket, awaitingScrub} from './dataPuller.js';
import { visualizeTool } from './visualizer.js';

let visualizer;
let dataProcessor;
let newData = {};
let waitingForAssignment = {};
let waitingForScrub = {};
let closedTickets = {};


document.addEventListener('DOMContentLoaded', () => {

    const mainNavContainer = document.querySelector('.main-nav-container');
    const displayManager = new visualizeTool('visualizer');
    const expandRow = document.querySelector('.expander-row');

    displayManager.displayByView('home');

    mainNavContainer.addEventListener('click', (e) => {
        const clicked = e.target;
        const parentRow = clicked.closest('.nav-section-row');

        // Handle Section Row Click
        if (parentRow && !clicked.classList.contains('expander')) {
            console.log('what did i click?', clicked.classList)
            document.querySelectorAll('.nav-section-row').forEach(row => {
                row.classList.remove('active');
            });
            parentRow.classList.add('active');

            let selected = '';
            if (parentRow.querySelector('.home-icon')) {
                selected = 'home';
                displayManager.clearVisualizer();
                displayManager.displayByView(selected, waitingForAssignment, newData);
            } else if (parentRow.querySelector('.ame-icon')) {
                selected = 'ame';
                displayManager.clearVisualizer();
                displayManager.displayByView(selected, waitingForAssignment, newData);
            } else if (parentRow.querySelector('.ima-icon')) {
                selected = 'ima';
                console.log(selected);
            } else if (parentRow.querySelector('.help-icon')) {
                selected = 'help';
                console.log(selected);
            }
        }
    });

    // Add event listener for all section rows to handle expand/collapse
    const sectionRows = document.querySelectorAll('.nav-section-row');
    sectionRows.forEach(sectionRow => {
        sectionRow.addEventListener('click', (e) => {
            if (e.target.classList.contains('nav-row-expand')) {
                const sectionContainer = sectionRow.closest('.nav-section-container');
                const rows = sectionContainer.querySelectorAll('.nav-section-row');
                rows.forEach(row => {
                    row.classList.toggle('expanded');
                });
            }
        });
    });

    // Handle hover to expand navigation
    expandRow.addEventListener('mouseenter', () => {
        mainNavContainer.classList.add('expanded');
    });

    mainNavContainer.addEventListener('mouseleave', () => {
        mainNavContainer.classList.remove('expanded');
    });
});



